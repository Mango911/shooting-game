<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>æ¸¸æˆçŠ¶æ€è°ƒè¯•</title>
    <style>
        body { font-family: monospace; background: #111; color: #0f0; padding: 20px; }
        .status { margin: 10px 0; padding: 10px; border: 1px solid #0f0; }
        .error { border-color: #f00; color: #f00; }
    </style>
</head>
<body>
    <h1>æ¸¸æˆçŠ¶æ€å®æ—¶è°ƒè¯•</h1>
    <div id="status"></div>
    <button onclick="checkGameState()">åˆ·æ–°çŠ¶æ€</button>
    <button onclick="startGame()">å¼ºåˆ¶å¼€å§‹æ¸¸æˆ</button>
    
    <script>
        function addStatus(message, isError = false) {
            const div = document.createElement('div');
            div.className = `status ${isError ? 'error' : ''}`;
            div.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
            document.getElementById('status').appendChild(div);
        }
        
        function checkGameState() {
            const iframe = document.createElement('iframe');
            iframe.src = 'http://localhost:8000/';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            iframe.onload = function() {
                try {
                    const game = iframe.contentWindow.game;
                    if (!game) {
                        addStatus('âŒ æ¸¸æˆå®ä¾‹æœªæ‰¾åˆ°', true);
                        return;
                    }
                    
                    addStatus(`ğŸ® æ¸¸æˆçŠ¶æ€: ${game.gameState}`);
                    addStatus(`ğŸ”„ æ¸¸æˆå¾ªç¯è¿è¡Œ: ${game.gameLoopRunning}`);
                    addStatus(`ğŸ“Š åˆ†æ•°: ${game.score}, å…³å¡: ${game.level}`);
                    addStatus(`ğŸ‘¾ æ•Œæœºæ•°é‡: ${game.enemies.length}`);
                    addStatus(`ğŸ é“å…·æ•°é‡: ${game.powerUps.length}`);
                    addStatus(`ğŸ”« å­å¼¹æ•°é‡: ${game.bullets.length}`);
                    
                    if (game.spawnManager) {
                        const now = Date.now();
                        addStatus(`â° è·ç¦»ä¸Šæ¬¡æ•Œæœºç”Ÿæˆ: ${now - game.spawnManager.lastEnemySpawn}ms`);
                        addStatus(`âš™ï¸ æ•Œæœºç”Ÿæˆé—´éš”: ${game.spawnManager.enemySpawnRate}ms`);
                        addStatus(`ğŸ¯ åº”è¯¥ç”Ÿæˆæ•Œæœº: ${(now - game.spawnManager.lastEnemySpawn) > game.spawnManager.enemySpawnRate}`);
                    }
                    
                    if (game.stateManager) {
                        addStatus(`ğŸ¯ isPlaying(): ${game.stateManager.isPlaying()}`);
                    }
                    
                } catch (error) {
                    addStatus(`âŒ æ£€æŸ¥å¤±è´¥: ${error.message}`, true);
                }
                
                document.body.removeChild(iframe);
            };
        }
        
        function startGame() {
            const iframe = document.createElement('iframe');
            iframe.src = 'http://localhost:8000/';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            iframe.onload = function() {
                try {
                    const game = iframe.contentWindow.game;
                    if (game && game.stateManager) {
                        game.stateManager.startGame();
                        addStatus('ğŸš€ å¼ºåˆ¶å¯åŠ¨æ¸¸æˆ');
                        setTimeout(() => checkGameState(), 1000);
                    }
                } catch (error) {
                    addStatus(`âŒ å¯åŠ¨å¤±è´¥: ${error.message}`, true);
                }
                
                document.body.removeChild(iframe);
            };
        }
        
        // è‡ªåŠ¨æ£€æŸ¥
        setTimeout(checkGameState, 2000);
        setInterval(checkGameState, 10000);
    </script>
</body>
</html>