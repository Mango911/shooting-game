<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆè°ƒè¯•é¡µé¢</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: #1a1a1a; 
            color: #fff; 
            margin: 20px;
        }
        .section {
            background: #2a2a2a;
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .error { color: #ff6b6b; }
        .success { color: #4ecdc4; }
        .warning { color: #feca57; }
        pre {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        canvas {
            border: 2px solid #4ecdc4;
            background: #000;
        }
        #console-output {
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸ› æ¸¸æˆè°ƒè¯•æ§åˆ¶å°</h1>
    
    <div class="section">
        <h3>ğŸ“Š åŠ è½½çŠ¶æ€</h3>
        <div id="load-status">æ­£åœ¨æ£€æµ‹...</div>
    </div>
    
    <div class="section">
        <h3>ğŸ® æ¸¸æˆæµ‹è¯•åŒºåŸŸ</h3>
        <canvas id="gameCanvas" width="800" height="600"></canvas>
    </div>
    
    <div class="section">
        <h3>ğŸ“‹ æ§åˆ¶å°è¾“å‡º</h3>
        <div id="console-output"></div>
    </div>
    
    <div class="section">
        <h3>ğŸ”§ æ¨¡å—æµ‹è¯•</h3>
        <div id="module-tests"></div>
    </div>

    <script type="module">
        const loadStatus = document.getElementById('load-status');
        const consoleOutput = document.getElementById('console-output');
        const moduleTests = document.getElementById('module-tests');
        const canvas = document.getElementById('gameCanvas');
        
        // æ•è·æ‰€æœ‰æ§åˆ¶å°è¾“å‡º
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function logToPage(message, type = 'log') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleOutput.appendChild(div);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = (...args) => {
            originalLog(...args);
            logToPage(args.join(' '), 'success');
        };
        
        console.error = (...args) => {
            originalError(...args);
            logToPage('âŒ ' + args.join(' '), 'error');
        };
        
        console.warn = (...args) => {
            originalWarn(...args);
            logToPage('âš ï¸ ' + args.join(' '), 'warning');
        };
        
        // æ•è·æœªå¤„ç†çš„é”™è¯¯
        window.addEventListener('error', (event) => {
            logToPage(`âŒ JavaScripté”™è¯¯: ${event.message} åœ¨ ${event.filename}:${event.lineno}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            logToPage(`âŒ Promiseé”™è¯¯: ${event.reason}`, 'error');
        });
        
        // æ¨¡å—æµ‹è¯•
        async function testModules() {
            loadStatus.innerHTML = 'ğŸ” å¼€å§‹æµ‹è¯•...';
            const results = [];
            
            try {
                // æµ‹è¯•åŸºç¡€æ¨¡å—
                loadStatus.innerHTML = 'ğŸ“¦ æµ‹è¯• gameConfig...';
                const { GAME_CONFIG } = await import('./dist/config/gameConfig.js');
                results.push('âœ… gameConfig åŠ è½½æˆåŠŸ');
                
                loadStatus.innerHTML = 'ğŸ“¦ æµ‹è¯• AudioManager...';
                const AudioManager = await import('./dist/managers/AudioManager.js');
                results.push('âœ… AudioManager åŠ è½½æˆåŠŸ');
                
                loadStatus.innerHTML = 'ğŸ“¦ æµ‹è¯• InputManager...';
                const InputManager = await import('./dist/managers/InputManager.js');
                results.push('âœ… InputManager åŠ è½½æˆåŠŸ');
                
                loadStatus.innerHTML = 'ğŸ“¦ æµ‹è¯• ParticleSystem...';
                const ParticleSystem = await import('./dist/classes/Particle.js');
                results.push('âœ… ParticleSystem åŠ è½½æˆåŠŸ');
                
                loadStatus.innerHTML = 'ğŸ“¦ æµ‹è¯• Game ä¸»ç±»...';
                const { default: Game } = await import('./dist/Game.js');
                results.push('âœ… Game ä¸»ç±»åŠ è½½æˆåŠŸ');
                
                loadStatus.innerHTML = 'ğŸ® å°è¯•åˆ›å»ºæ¸¸æˆå®ä¾‹...';
                const game = new Game(canvas);
                results.push('âœ… æ¸¸æˆå®ä¾‹åˆ›å»ºæˆåŠŸ');
                
                loadStatus.innerHTML = 'ğŸš€ å°è¯•å¯åŠ¨æ¸¸æˆ...';
                game.start();
                results.push('âœ… æ¸¸æˆå¯åŠ¨æˆåŠŸï¼');
                
                loadStatus.innerHTML = '<span class="success">âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼æ¸¸æˆå¯ä»¥æ­£å¸¸è¿è¡Œ</span>';
                
                // è®¾ç½®å…¨å±€æ¸¸æˆå¯¹è±¡ç”¨äºè°ƒè¯•
                window.game = game;
                results.push('ğŸ”§ è°ƒè¯•å¯¹è±¡å·²è®¾ç½®: window.game');
                
            } catch (error) {
                results.push(`âŒ é”™è¯¯: ${error.message}`);
                results.push(`ğŸ“ å †æ ˆ: ${error.stack}`);
                loadStatus.innerHTML = `<span class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</span>`;
            }
            
            moduleTests.innerHTML = results.map(r => `<div>${r}</div>`).join('');
        }
        
        // å¼€å§‹æµ‹è¯•
        console.log('ğŸš€ å¼€å§‹æ¸¸æˆè°ƒè¯•...');
        testModules();
        
        // æ˜¾ç¤ºæµè§ˆå™¨ä¿¡æ¯
        console.log(`ğŸŒ æµè§ˆå™¨: ${navigator.userAgent}`);
        console.log(`ğŸ“± è§†å£: ${window.innerWidth}x${window.innerHeight}`);
    </script>
    
    <script>
        // æ·»åŠ ä¸€äº›è°ƒè¯•å·¥å…·
        window.debugInfo = {
            showStats: () => {
                if (window.game) {
                    console.log('ğŸ® æ¸¸æˆç»Ÿè®¡:', window.game.getStats());
                } else {
                    console.log('âŒ æ¸¸æˆå®ä¾‹ä¸å­˜åœ¨');
                }
            },
            toggleDebug: () => {
                if (window.game) {
                    window.game.debug.toggleDebug();
                } else {
                    console.log('âŒ æ¸¸æˆå®ä¾‹ä¸å­˜åœ¨');
                }
            },
            restart: () => {
                if (window.game) {
                    window.game.reset();
                    console.log('ğŸ”„ æ¸¸æˆå·²é‡ç½®');
                } else {
                    console.log('âŒ æ¸¸æˆå®ä¾‹ä¸å­˜åœ¨');
                }
            }
        };
        
        console.log('ğŸ”§ è°ƒè¯•å·¥å…·å·²åŠ è½½:');
        console.log('- debugInfo.showStats() - æ˜¾ç¤ºæ¸¸æˆç»Ÿè®¡');
        console.log('- debugInfo.toggleDebug() - åˆ‡æ¢è°ƒè¯•æ¨¡å¼'); 
        console.log('- debugInfo.restart() - é‡å¯æ¸¸æˆ');
    </script>
</body>
</html> 